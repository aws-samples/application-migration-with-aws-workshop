+++
title = "エンドポイントの作成"
weight = 30
+++


### ソースとターゲットのエンドポイントの作成

**AWS Database Migration Service (DMS)** のページで、左のメニューから **「エンドポイント」** を選択し、**「エンドポイントの作成」** ボタンをクリックします。

1. ソースエンドポイントを作成します。 

    以下のパラメータを使用して、エンドポイントを構成します：

    | パラメータ           | 入力値                                          |
    | ------------------- | ---------------------------------------------- |
    | エンドポイントタイプ    | ソースエンドポイント                                |
    | エンドポイント識別子    | source-endpoint                                |
    | ソースエンジン         | mysql                                          |
    | サーバー名            | **自身の環境**でハンズオンを実施している場合は、<a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2#/" target="_blank" rel="noopener noreferrer">CloudFormation スタック</a>（**ApplicationMigrationWorkshop**）の**出力**セクションに表示されている **DBServerDNSName** の値を入力。<br> **AWS 主催のイベント**の場合は、Event Engine の Team Dashboard に表示されている **Database Server IP** を入力。   |
    | ポート                | 3306                                           |
    | SSL モード            | none                                           |
    | ユーザー名            | wordpress-user                                 |
    | パスワード            | AWSRocksSince2006                                   |

    ![source-endpoint](/db-mig/source-endpoint.ja.png)

    **「エンドポイント接続のテスト（オプション）」** セクションを開き、**Virtual Private Cloud (VPC)** のドロップダウンリストから **TargetVPC** を選択し、**「テストの実行」** ボタンをクリックすることで、エンドポイントの設定が有効であることを確認します。

    ![test-source-endpoint](/db-mig/test-source-endpoint.ja.png)

    テストには1分ほどかかります。**ステータス**欄に **successful** のメッセージが表示されたことを確認したら、**「エンドポイントの作成」** ボタンをクリックして、ソースエンドポイントを作成します。
    
    エラーが発生した場合は、エンドポイントのパラメータが正しく設定されていること、また DMS レプリケーションインスタンスが、**パブリックアクセス可能**に設定されていることを確認してください。

2. ターゲットエンドポイントを作成します。

    上記の手順を繰り返し、以下のパラメータを使用して、ターゲットエンドポイントを作成します。

    | パラメータ           | 入力値                                                 |
    | ------------------- | ----------------------------------------------------- |
    | エンドポイントタイプ       | ターゲットエンドポイント                                       |
    | RDS DB インスタンスの選択  | チェックを入れる                                            |
    | RDS インスタンス          | 前頁で作成した Amazon Relational Database Service (RDS) のインスタンスをドロップダウンリストから選択（表示されない場合は、手動で DB 識別子を入力）  |
    | エンドポイント識別子       | target-endpoint                                       |
    | ターゲットエンジン         | mysql （自動入力）                                                |
    | サーバー名                | RDS インスタンスの DNS エンドポイント（自動入力）                             |
    | ポート                   | 3306（自動入力）                                            |
    | SSL モード               | none                                                  |
    | ユーザー名                | 自動入力                                                |
    | パスワード               | RDS インスタンスを作成した際に指定したパスワードを入力 |


3. **「エンドポイント固有の設定」 → 「追加の接続属性」** に、以下の値を入力します：

    ```
    parallelLoadThreads=1; initstmt=SET FOREIGN_KEY_CHECKS=0
    ```

4. **「エンドポイント接続のテスト（オプション）」** セクションを開き、**VPC** のドロップダウンリストから **TargetVPC** を選択し、**「テストの実行」** ボタンをクリックすることで、エンドポイントの設定が有効であることを確認します。

    テストには1分ほどかかります。**ステータス**欄に **successful** のメッセージが表示されたことを確認したら、**「エンドポイントの作成」** ボタンをクリックして、ターゲットエンドポイントを作成します。

エラーが発生した場合、RDS インスタンス用の **VPC セキュリティグループ**が、 **DMS レプリケーションインスタンス**用のセキュリティグループ（または **TargetVPC** 全体 - 10.0.0.0/16）からの、ポート3306に対するインバウンドトラフィックを許可していることを確認してください。

{{% notice note %}}
エンドポイントのリストから、**「アクション」 → 「接続のテスト」** をクリックして、追加の接続テストを実施することができます。
{{% /notice %}}
